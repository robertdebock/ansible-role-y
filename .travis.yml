---
#
# Ansible managed
#
language: python

os: linux
dist: xenial

python:
  - "3.8"

services:
  - docker

env:
  global:
    namespace="robertdebock"
  jobs:
    - image="alpine" tag="latest"
    - image="alpine" tag="edge"
    - image="amazonlinux" tag="1"
    - image="centos" tag="7"
    - image="centos" tag="latest"
    - image="debian" tag="latest"
    - image="debian" tag="bullseye"
    - image="fedora" tag="31"
    - image="fedora" tag="latest"
    - image="opensuse" tag="latest"
    - image="ubuntu" tag="latest"
    - image="ubuntu" tag="bionic"
    - image="ubuntu" tag="xenial"

cache:
  - pip

install:
  - pip install --upgrade pip
  - pip install tox

script:
  - function retry { counter=0 ; until "$@" ; do exit=$? ; counter=$(($counter + 1)) ; if [ $counter -ge 3 ] ; then return $exit ; fi ; done ; return 0; } ; retry tox

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: "L4dazUjJg/3hWIXEGJA/p9hJaawicNTbaQ/qBhpAUvgQ0t6AGTe3oRXJYdYfA3JuVzxCvC7QtGOBPZO8b6W1PB5K0jFPYd2HrcG7rt6LnNe/yWvqe7xvU2viV79eT4C+jPAjcDeJ1n3UIy9GkichWzj/xvT2vyXyMlW7pDk3sjpsqGJTxFuFkUzH9mDDoulfrQhHo5RJ6l+OyqaQfm6oTWeP1VuYTd+Cet8+wvhbSCTrEhUI3MB5HLRGxNaf/kaynbmpB0jp4w03Ja2VDSZerlvh/Zt/PwmeyUGmIZfHyHisSvP5Ls0i29/167lSSKYf70ryJw1jbaTZEeR09yW16O19JzRXe6E3eXvwtsNe0g5BJhSQyrSxxVqIpnodfWq5rHzUkfN0bUgrkytUGsRfE/D8a2hHKWi5VZj1vMXbTmCWjUeo9jjoEBaZ7I5qBYV+DklJ3PAzrJBR83dIo9+FIjIODTmi3By1nYb1PUI+EwPbkSSvFQy51DZA9yVM072k0Km2HYWHgTbm+wx+22phWFwOISymM9lglLpXDdAsQI2fC9CtWsOniqR3S2bFpmNCVQkpp7cJzQBlLDMyhOcajDFXgbiBormp9iqOktI5XfO9U+kNf+LRz/Jt6ucTT98se1ICklbxy7cCqGI0r/wY8UvBxLUDrUYMC7TPXdexXN8="
    on_success: change
    template: "%{result}: %{repository_slug}@%{branch}, build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>)"
  email: false
